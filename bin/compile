#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

set -e

indent() {
  sed -u 's/^/       /'
}

echo "-----> Installing Subversion."

# Needed by ./get-deps.sh
sudo apt-get install unzip

# http://blog.ashodnakashian.com/2012/11/building-subversion-on-ubuntu-12-10/
curl http://mirror.catn.com/pub/apache/subversion/subversion-1.8.5.tar.bz2 -o subversion-1.8.5.tar.bz2
tar -xjvf subversion-1.8.5.tar.bz2
cd subversion-1.8.5

./get-deps.sh
cd apr/; ./buildconf; cd ..
cd apr-util/; ./buildconf; cd ..
cd apr-util/xml/expat/; ./buildconf.sh; cd ../../..
./autogen.sh

./configure --disable-mod-activation --without-gssapi --without-apxs --without-berkeley-db --without-serf --without-swig --without-ctypesgen --without-kwallet --without-gnome-keyring --disable-javahl --disable-keychain -C
make mkdir-init external-all fsmod-lib ramod-lib lib bin

make check TESTS="`echo subversion/tests/cmdline/{basic_tests.py,merge_tests.py}`"

make install
